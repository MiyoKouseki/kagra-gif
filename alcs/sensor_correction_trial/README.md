
# Sensor Correction Trial
## Measurement Scripts
template.py : template file to measure 

## Measurements

|Name| Start(JST)| End(JST) | tlen(min) | IP_DAMP | BF_DAMP | Pay_DAMP | SC| diffs |
|---|---|---|---|---|---|---|---|---|
|SC1_0 | Sep 06 00:30:00 | Sep 06 01:30:00 | 60 | L,T,Y | Y | P,Y(OL_TM2IM) | SC\_SEIS | ETMX:(P07,08,12,14,15,TM2MN\_P,TM2IM\_P) ITMX:(P02,03,04,05,13),  | 
|SC1_1 | Sep 06 01:40:00 | Sep 06 02:40:00 | 60 | L,T,Y | Y | P,Y(OL_TM2IM) | SC\_SEIS | ETMX:(P07,08,12,14,15,TM2MN\_P,TM2IM\_P) ITMX:(P02,03,04,05,13),  | 
|SC1_2 | Sep 06 02:52:00 | Sep 06 03:02:00 | 10 | L,T,Y | Y | P,Y(OL_TM2IM) | SC\_GIF | ETMX:(P07,08,12,14,15,TM2MN\_P,TM2IM\_P) ITMX:(P02,03,04,05,13),  |
|SC1_3 | Sep 06 03:10:00 | Sep 06 03:20:00 | 10 | L,T,Y | Y | P,Y(OL_TM2IM) | SC\_GIF(G=-1) | ETMX:(P07,08,12,14,15,TM2MN\_P,TM2IM\_P) ITMX:(P02,03,04,05,13),  |  
|SC1_4 | Sep 06 03:22:00 | Sep 06 04:00:00 | 38 | L,T,Y | Y | P,Y(OL_TM2IM) | SC\_GIF | ETMX:(P07,08,12,14,15,TM2MN\_P,TM2IM\_P) ITMX:(P02,03,04,05,13),  | 
|SC1_5 | Sep 06 03:42:00 | Sep 06 04:42:00 | 60 | L,T,Y | Y | P,Y(OL_TM2IM) | SC\_GIF | ETMX:(P07,08,12,14,15,TM2MN\_P,TM2IM\_P) ITMX:(P02,03,04,05,13),  |  
|---|---|---|---|---|---|---|---|---|
|SC2_0 | Sep 17 05:26:00 | Sep 17 05:36:00 | 10 | L(G=0.5),T,Y | Y | P,Y(OL_TM2IM) | No | ETMX:(P07,08,14,15) ITMX:(P02,03,04,05),  | 
|SC2_1 | Sep 17 05:39:00 | Sep 17 05:49:00 | 10 | L(G=0.5),T,Y | Y | P,Y(OL_TM2IM) | SC\_GIF | ETMX:(P07,08,14,15) ITMX:(P02,03,04,05),  | 
|---|---|---|---|---|---|---|---|---|
|SC3_0 | Sep 23 20:43:00 | Sep 23 20:53:00 | 10 | L,T,Y | Y | Y(OL_TM2IM) | SC\_GIF(G=1.4) | ETMX:(P07,08,12,14,15,TM2MN\_P,TM2IM\_P) ITMX:(P02,03,04,05),  |
|SC3_1 | Sep 23 21:09:00 | Sep 23 21:19:00 | 10 | L,T,Y | Y | Y(OL_TM2IM) | SC\_GIF | ETMX:(P07,08,12,14,15,TM2MN\_P,TM2IM\_P) ITMX:(P02,03,04,05),  |
|SC3_2 | Sep 23 21:22:00 | Sep 23 21:32:00 | 10 | L,T,Y | Y | Y(OL_TM2IM) | SC\_GIF(G=1.2) | ETMX:(P07,08,12,14,15,TM2MN\_P,TM2IM\_P) ITMX:(P02,03,04,05),  | 
|SC3_3 | Sep 23 21:34:00 | Sep 23 21:44:00 | 10 | L,T,Y | Y | Y(OL_TM2IM) | SC\_GIF(G=0.8) | ETMX:(P07,08,12,14,15,TM2MN\_P,TM2IM\_P) ITMX:(P02,03,04,05),  | 
|SC3_4 | Sep 23 21:46:00 | Sep 23 21:56:00 | 10 | L,T,Y | Y | Y(OL_TM2IM) | SC\_GIF(G=1.1) | ETMX:(P07,08,12,14,15,TM2MN\_P,TM2IM\_P) ITMX:(P02,03,04,05),  | 
|SC3_5 | Sep 23 22:35:00 | Sep 23 22:45:00 | 10 | L(G=0.5),T,Y | Y | Y(OL_TM2IM) | SC\_GIF | ETMX:(P07,08,12,14,15,TM2MN\_P,TM2IM\_P) ITMX:(P02,03,04,05),  | 
|SC3_6 | Sep 23 22:46:00 | Sep 23 22:56:00 | 10 | L,T,Y | Y | Y(OL_TM2IM) | SC\_GIF | ETMX:(P07,08,12,14,15,TM2MN\_P,TM2IM\_P) ITMX:(P02,03,04,05),  |  
|SC3_7 | Sep 23 23:25:00 | Sep 23 23:35:00 | 10 | L,T,Y | Y | Y(OL_TM2IM) | SC\_GIF | ETMX:(P07,08,12,14,15,TM2MN\_P,TM2IM\_P) ITMX:(P02,03,04,05),  | 
|SC3_8 | Sep 23 20:57:00 | Sep 23 21:07:00 | 10 | L,T,Y | Y | Y(OL_TM2IM) | NO | ETMX:(P07,08,12,14,15,TM2MN\_P,TM2IM\_P) ITMX:(P02,03,04,05),  | 
|---|---|---|---|---|---|---|---|---|
|SC4_0 | Sep 24 21:55:00 | Sep 24 22:05:00 | 10 | L | Y | P,Y(OL_TM2IM) | SC_GIF | ETMX:(P07,08,12,14,15) ITMX:(P02,03,04,05) |  
|SC4_1 | Sep 24 23:20:00 | Sep 25 00:10:00 | 30 | L | Y | P,Y(OL_TM2IM) | SC_GIF | ETMX:(P07,08,12,14,15) ITMX:(P02,03,04,05) |
|SC4_2 | Sep 25 00:11:00 | Sep 25 00:38:00 | 27 | L | Y | P,Y(OL_TM2IM) | SC_GIF | ETMX:(P07,08,12,14,15,TM2MN_P) ITMX:(P02,03,04,05),  |
|SC4_3 | Sep 25 00:53:00 | Sep 25 01:03:00 | 10 | L | Y | P,Y(OL_TM2IM) | SC_GIF | ETMX:(P07,08,12,14,15,TM2MN_P) ITMX:(P02,03,04,05),  | 
|SC4_4 | Sep 25 01:15:00 | Sep 25 01:40:00 | 25 | L | Y | P,Y(OL_TM2IM) | SC_GIF | No diff | 
|SC4_5 | Sep 24 22:08:00 | Sep 24 22:18:00 | 10 | L | Y | P,Y(OL_TM2IM) | No | ETMX:(P07,08,12,14,15) ITMX:(P02,03,04,05) | 
|SC4_6 | Sep 24 22:42:00 | Sep 24 22:52:00 | 10 | L | Y | P,Y(OL_TM2IM) | No | ETMX:(P07,08,12,14,15) ITMX:(P02,03,04,05) |
|---|---|---|---|---|---|---|---|---|
|SC_ |  |  | - | - | - | - | - | - |


## Comment
* **Sensor Correction Matrix (SC Matrix)** : K1:VIS-ETMX\_IP\_SEISALIGHN
* **Sensor Correction Filter Gain (SC Gain)** : K1:VIS-ETMX\_IP\_SENSCORR_L\_GAIN


### SC1
**SC1では、GIFの符号がアームの信号に対して合っているか確かめた。**

* SC1\_0
	* a 
* SC1\_1
	* a
* SC1_2
	* SC matrix\_1\_3 = 1 
	* SC gain = -1
	* Actual SC gain was megative. It was correct sign.
* SC1_3 
	* SC matrix\_1\_3 = -1 
	* SC gain = -1
	* Actual SC gain was positive. It was not correct.
* SC1_4
	* SC matrix\_1\_3 = 1 
	* SC gain = -1
	* Correcti sign, but I founnd that control signal was saturating by limitter on SC Filter.
* SC1_5
	* SC\_gain was same as the SC1\_4, and SC1\_2.
	* Increase the limiter.
SC1_0,1 で地震計のSCを
SC1_2,3 でGIFの符号を調べた。SC_1_4でGIFのLimitterで信号がサチった。

 
### SC2
**SC1ではゲインを上げすぎていたせいか150mHzでコヒーレンスを持っていなかった。なのでSC2では、ゲインを半分にしてどう変わるか調べてみた。**

* SC2_0
	* IP のDCDAMPのゲインは1のまま、SC1_2とかと同じ状態。
* SC2_1
	* IP のDCDAMPのゲインは0.5。

### SC3
SCのゲインが合っていないと考え、変えて測定してみた。

* SC3_0
	* SC Gain = 1.4
* SC3_1
	* SC Gain = 1.0
* SC3_2
	* SC Gain = 1.2
* SC3_3
 	* SC Gain = 0.8
* SC3_4
	* SC Gain = 1.1
* SC3_5
 	* SC Gain = 1.0
 	* IP Gain = 0.5
 	* Include a Glitch caused by GIF
* SC3_6
 	* Gain of SC, IP are the same as SC3\_5
* SC3_7
 	* Same as the SC2\_0
 	* SC Gain = 1.0
 	* IP Gain = 1.0
* SC3_8
 	* SC Gain = 0.0
 	* IP Gain = 1.0

### SC4
他の自由度からのカップリングがあることがわかったので、YawとPay以外はすべて切った。FBのループが無くなったので、 150 mHz のピークの問題は 200 mHz に移動。

* SC4_0
 	* 
* SC4_1
 	* ETMX_MN_P12 に 210 mHz の Notchを入れた
* SC4_2
 	* ETMX_BF_YAW に 210 mHz の Notchを入れた
* SC4_3
 	* P12を改良
* SC4_4
 	* ??
* SC4_5
 	* ??
* SC4_6
 	* ?? 


## 制御状態の調べ方
制御の状態は、制御フィルターの各種ボタンが押されているかどうかの値と、信号を分配するマトリックスの値で決まる。これらは miyopy/script/filtstatus で調べることができる。/miyopy/script/filtstatus/main.py にMeasurementの名前（例：sc1_1）を与えて、実行するとボタンとマトリックスの値が出力される。それぞれの出力結果は以下の場所に、保存した。

 * ボタン : miypy/script/filtstatus/results/sc1_1.txt 
 * マトリックス : miypy/script/filtstatus/results/sc1_1_matrix.txt

はじめにボタンの状態について。知りたい情報は、IP、BF、PayloadのFBループとSCが入っているかどうかなので、上記の出力ファイルを以下のコマンドに通して、情報を抜き取った。

```bash
cd /Users/miyo/Dropbox/Git/miyopy/script/filtstatus/results
for j in {0..9} ; do for i in {0..9} ; do echo sc${j}_${i}; less sc${j}_${i}.txt | awk -F'[,]' '{print $1,$2,$5}'| grep -e DAMP -e SENSCORR | grep -v 0.00000e+00 | grep -v GAS |grep -v NO_| grep -v BLADE ;done > ../../../../kagra-gif/alcs/sensor_correction_trial/filtstatus/sc${j}.txt ; done
```
このコマンドは、どの段の Local FeedBack と Sensor Correction が ON になっているかどうかの情報が抜き出せれる。ちなみにこのコマンドはすべての段について DAMP と SC のみを調べているだけで、TEST や BLADE は調べていない。まあTESTとBLADEはDC位置を変えるためにつかうフィルターなので、おそらくなにもない限り一緒だとおもう。

次にマトリックスの状態について。以下のコマンドを使って調べた。

```bash
cd /Users/miyo/Dropbox/Git/miyopy/script/filtstatus/results
for j in {0..9} ; do for i in {0..9} ; do echo sc${j}_${i}; less sc${j}_${i}_matrix.txt | grep IP_SEISALIGN ;done > ../../../../kagra-gif/alcs/sensor_correction_trial/filtstatus/sc${j}_matrix.txt ;done
```
このコマンドは、地震計かGIFか信号を選択してSC信号にするマトリックスのみを抜き出している。

最後に、2つのコマンドを使って抜き出した情報は

> /Users/miyo/Dropbox/Git/kagra-gif/alcs/sensor_correction_trial/filtstatus

にある。このファイルをみて、Measurementの表を埋めた。


